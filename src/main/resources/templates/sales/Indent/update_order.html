<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="static/lib/layui/css/layui.css">
    <script src="static/js/jquery-2.1.1.js"></script>
    <script src="static/lib/layui/layui.js"></script>
    <style>
        .layui-form-label{
            width: 85px;
        }
    </style>
</head>
<body>
<form class="layui-form" action="javascript:;" id="updateOrderForm">
    <div class="layui-form-item">
        <label class="layui-form-label">订单编号</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" th:value="${order.orderId}" name="orderId" autocomplete="off" class="layui-input" readonly>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">名称</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderName" th:value="${order.orderName}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">所属客户类型</label>
        <div class="layui-input-inline">
            <select name="fkCusTypeId" lay-filter="fkCusTypeId" id="fkCusTypeId" lay-verify="required">
                <option value="0" th:selected="${order.fkCusTypeId}==0">企业客户</option>
                <option value="1" th:selected="${order.fkCusTypeId}==1">个人客户</option>
            </select>
        </div>
        <div class="layui-input-inline">
            <input type="text" name="fkCusName" th:value="${order.fkCusName}" id="fkCusName" autocomplete="off" class="layui-input">
        </div>
        <button class="layui-btn" onclick="xzkhType()">选择</button>
        <button class="layui-btn" onclick="clears(1)">清空</button>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">所属对象类型</label>
        <div class="layui-input-inline">
            <select name="fkObjectTypeId" lay-filter="fkObjectTypeId" lay-verify="required">
                <option value="0" th:selected="${order.fkObjectTypeId}==0">销售机会</option>
                <option value="1" th:selected="${order.fkObjectTypeId}==1">故障报修</option>
            </select>
        </div>
        <div class="layui-input-inline">
            <input type="text" name="fkObjectName" th:value="${order.fkObjectName}" id="fkObjectName"  autocomplete="off" class="layui-input">
        </div>
        <button class="layui-btn" onclick="dxType()">选择</button>
        <button class="layui-btn" onclick="clears(2)">清空</button>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">分类</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderType" lay-filter="aihao">
                <option value="0" th:selected="${order.orderType}==0">产品销售</option>
                <option value="1" th:selected="${order.orderType}==1">服务</option>
                <option value="2" th:selected="${order.orderType}==2">代销</option>
                <option value="3" th:selected="${order.orderType}==3">分销</option>
                <option value="4" th:selected="${order.orderType}==4">业务合作</option>
                <option value="5" th:selected="${order.orderType}==5">其它</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">不含税总额</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderTotalSum" th:value="${order.orderTotalSum}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">毛利润</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderGrossProfit" th:value="${order.orderGrossProfit}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">税额</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderRevenue" th:value="${order.orderRevenue}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">销售额</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderSaleroom" th:value="${order.orderSaleroom}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">客户签约人</label>
        <div class="layui-input-inline" style="width: 390px">
            <input type="text" name="fkContactsId" th:value="${order.fkContactsId}" id="fkContactsId" autocomplete="off" class="layui-input">
        </div>
        <button class="layui-btn" onclick="khqyrWindow()">选择</button>
        <button class="layui-btn" onclick="clears(3)">清空</button>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">付款方式</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderPayment" lay-filter="aihao">
                <option value="0" th:selected="${order.orderPayment}==0">支票</option>
                <option value="1" th:selected="${order.orderPayment}==1">现金</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">开始时间</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" th:value="${order.orderStartTime}" name="orderStartTime"  class="layui-input test-item" placeholder="yyyy-MM-dd HH:mm:ss">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">结束时间</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderEndTime" th:value="${order.orderEndTime}" class="layui-input test-item" placeholder="yyyy-MM-dd HH:mm:ss">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">收货人姓名</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderConsigneeName" th:value="${order.orderConsigneeName}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">收货人电话</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderConsigneePhone" th:value="${order.orderConsigneePhone}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">收货人邮箱</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderConsigneeEmail" th:value="${order.orderConsigneeEmail}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">收货人地址</label>
        <div class="layui-input-inline" style="width: 540px">
            <textarea name="orderConsigneeAddress" placeholder="请输入内容" class="layui-textarea" th:text="${order.orderConsigneeAddress}"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">以收款金额</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderAmountRemitted" th:value="${order.orderAmountRemitted}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">以开票金额</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderInvoiceAmount" th:value="${order.orderInvoiceAmount}"  autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">审批状态</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderApprovalStatus" lay-filter="aihao">
                <option value="0" th:selected="${order.orderApprovalStatus}==0">审批中</option>
                <option value="1" th:selected="${order.orderApprovalStatus}==1">未启动</option>
                <option value="2" th:selected="${order.orderApprovalStatus}==2">已完成</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">审批时间</label>
        <div class="layui-input-inline" style="width: 540px">
            <input type="text" name="orderApprovalTime" th:value="${order.orderApprovalTime}" class="layui-input test-item" placeholder="yyyy-MM-dd HH:mm:ss">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">审批结果</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderApprovalResult" lay-filter="aihao">
                <option value="0" th:selected="${order.orderApprovalResult}==0">成功结束</option>
                <option value="1" th:selected="${order.orderApprovalResult}==1">失败结束</option>
                <option value="2" th:selected="${order.orderApprovalResult}==2">无</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">运输方式</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderTransportation" lay-filter="aihao">
                <option value="0" th:selected="${order.orderTransportation}==0">顺丰快递</option>
                <option value="1" th:selected="${order.orderTransportation}==1">中国邮政</option>
                <option value="2" th:selected="${order.orderTransportation}==2">圆通快递</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">结算方式</label>
        <div class="layui-input-inline" style="width: 540px">
            <select name="orderSettlement" lay-filter="aihao">
                <option value="0" th:selected="${order.orderSettlement}==0">支票</option>
                <option value="1" th:selected="${order.orderSettlement}==1">现金</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-inline" style="width: 540px">
            <textarea name="orderContext" th:text="${order.orderContext}" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>

    <div class="layui-form-item" hidden>
        <div class="layui-input-block">
            <button class="layui-btn" id="btnUpdateOrdre" lay-submit lay-filter="formDemo">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>

<script>
    //Demo
    layui.use(['form','table','layer','laydate'], function(){
        var form = layui.form
            ,table = layui.table
            ,layer = layui.layer
            ,laydate=layui.laydate;

        lay('.test-item').each(function(){
            laydate.render({
                elem: this
                ,trigger: 'click'
                ,type: 'datetime'
            });
        });
        //监听提交
        form.on('submit(formDemo)', function(data){
            $.ajax({
                url:"update_order_htmls",
                type:"post",
                data:$("#updateOrderForm").serialize(),
                dataType:"json",
                success:function (data) {
                    if (data>0){
                        layer.msg('修改成功', {icon: 1, time: 2000}, function () {
                            parent.location.reload();
                        });

                    }else{
                        layer.msg('修改失败',{icon:2})
                    }
                },
                error:function () {
                    layer.msg('ajax执行失败',{icon:2})
                }
            })
            return false;
        });
        //监听客户类型
        form.on('select(fkCusTypeId)', function(data){
            $("#fkCusName").val("");
        });
        //监听对象类型
        form.on('select(fkObjectTypeId)', function(data){
            $("#fkObjectName").val("");
        });
    });
</script>
<script>
    //打开客户类型页面
    function xzkhType(){
        var fkCusTypeId=$("#fkCusTypeId").val();
        var index=$('#khType');
        if(fkCusTypeId==1){
            index=$('#khType2')
        }
        layer.open({
            type: 1,
            area: ['900px', '300px'],
            content: index //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
            ,btn: ['确定', '取消']
            ,btnAlign: 'c'
            ,title:'所属客户类型'
            ,yes: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                $("#fkCusName").val(xzval.val());
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
                }
            ,btn2: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
                },
            zIndex: layer.zIndex, //重点1
            success: function(layero){
                layer.setTop(layero); //重点2
            }
        });
    }

    //打开对象类型页面
    function dxType(){
        var a=$('[name=fkObjectTypeId]').val();
        var index=$('#fkObjectTypeId1');
        if(a==1){
            index=$('#khType2')
        }
        layer.open({
            type: 1,
            area: ['900px', '300px'],
            content: index //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
            ,btn: ['确定', '取消']
            ,btnAlign: 'c'
            ,title:'所属对象类型'
            ,yes: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                $('[name=fkObjectName]').val(xzval.val());
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
            }
            ,btn2: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
            }
        });
    }

    //打开客户签约人页面
    function khqyrWindow(){
        layer.open({
            type: 1,
            area: ['900px', '300px'],
            content: $('#khqyrWindow') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
            ,btn: ['确定', '取消']
            ,btnAlign: 'c'
            ,title:'客户签约人'
            ,yes: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                $('[name=fkContactsId]').val(xzval.val());
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
            }
            ,btn2: function(index, layero){
                var xzval=$("input[type='checkbox']:checked")//获取选中的值;
                xzval.attr("checked",false);
                xzval.parent("td").parent("tr").css("background-color", "transparent")
                layer.close(index);
            }
        });
    }

    //清空数据方法
    function clears(i) {
        if(i==1){
            $("#fkCusName").val("");
        }
        if (i==2){
            $("#fkObjectName").val("");
        }
        if(i==3){
            $("#fkContactsId").val("");
        }
    }

</script>
<!--客户类型(企业客户)-->
<table class="layui-table" id="khType" hidden>
    <thead>
    <tr>
        <th></th>
        <th>简称</th>
        <th>客户全称</th>
        <th>分类</th>
        <th>联系电话</th>
        <th>负责人</th>
        <th>所属行业</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="client:${qyClient}">
        <td><input type="checkbox" th:value="${client.abbreviation}" style="zoom:150%;"></td>
        <td th:text="${client.abbreviation}"></td>
        <td th:text="${client.cusCustomername}"></td>
        <td th:text="${client.fkClassifId}"></td>
        <td th:text="${client.cusFinancialTelephone}"></td>
        <td th:text="${client.fkUserId}"></td>
        <td th:text="${client.fkIndustryId}"></td>
    </tr>
    </tbody>
</table>

<!--客户类型(个人客户)-->
<table class="layui-table" id="khType2" hidden>
    <thead>
    <tr>
        <th></th>
        <th>客户姓名</th>
        <th>客户分类</th>
        <th>所属行业</th>
        <th>电子邮箱</th>
        <th>移动电话</th>
        <th>单位名称</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="client:${grClient}">
        <td><input type="checkbox" th:value="${client.cusCustomername}" style="zoom:150%;"></td>
        <td th:text="${client.cusCustomername}"></td>
        <td th:text="${client.fkClassifId}"></td>
        <td th:text="${client.fkIndustryId}"></td>
        <td th:text="${client.cusMailboxCode}"></td>
        <td th:text="${client.cusFinancialTelephone}"></td>
        <td th:text="${client.cusSynopsis}"></td>
    </tr>
    </tbody>
</table>

<!--对象类型(销售机会)-->
<table class="layui-table" id="fkObjectTypeId1" style="overflow-x: auto; width: 1500px" hidden>
    <colgroup>
        <col width="50">
        <col width="200">
        <col width="200">
        <col width="100">
        <col width="150">
        <col width="150">
        <col width="100">
        <col width="100">
        <col width="100">
        <col width="100">
        <col width="100">
        <col width="100">
    </colgroup>
    <thead>
    <tr>
        <th></th>
        <th>销售机会名称</th>
        <th>所属客户</th>
        <th>负责人</th>
        <th>预期签单时间</th>
        <th>预期签单金额</th>
        <th>预期利润</th>
        <th>成功率(%)</th>
        <th>当前阶段</th>
        <th>销售模式</th>
        <th>是否关闭</th>
        <th>是否成功</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><input type="checkbox" value="免费服务" style="zoom:150%;"></td>
        <td>免费服务</td>
        <td>深圳ddd的大大</td>
        <td>普通</td>
        <td>无</td>
        <td>李销售</td>
        <td>服务业</td>
        <td>20</td>
        <td>20</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td><input type="checkbox" value="李四" style="zoom:150%;"></td>
        <td>李四</td>
        <td>深圳ddd的大大</td>
        <td>普通</td>
        <td>无</td>
        <td>李销售</td>
        <td>服务业</td>
        <td>20</td>
        <td>20</td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    </tbody>
</table>

<!--客户签约人-->
<table class="layui-table" id="khqyrWindow" hidden>
    <thead>
    <tr>
        <th></th>
        <th>姓名</th>
        <th>性别</th>
        <th>生日</th>
        <th>所在部门</th>
        <th>移动电话</th>
        <th>职务</th>
        <th>所属客户</th>
        <th>负责人</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><input type="checkbox" value="麻子" style="zoom:150%;"></td>
        <td>麻子</td>
        <td>深圳ddd的大大</td>
        <td>普通</td>
        <td>无</td>
        <td>李销售</td>
        <td>服务业</td>
        <td>2020-02-01</td>
        <td>2020-02-01</td>
    </tr>
    <tr>
        <td><input type="checkbox" value="李四" style="zoom:150%;"></td>
        <td>李四</td>
        <td>深圳ddd的大大</td>
        <td>普通</td>
        <td>无</td>
        <td>李销售</td>
        <td>服务业</td>
        <td>2020-02-01</td>
        <td>2020-02-01</td>
    </tr>
    </tbody>
</table>
<script>
    //点击选中
    $("table tr").slice(1).click(function () {
        var chks = $("input[type='checkbox']",this);
        if(!chks[0].checked){
            chks.prop("checked",true);
            $(this).css("background-color", "#93FF93");
        }else{
            chks.prop("checked",false);
            $(this).css("background-color", "transparent");
        }
        var length=$("input[type='checkbox']:checked").length;//获取选中的个数
        if (length>1){
            layer.msg('只能选中一个');
            chks.prop("checked",false);
            $(this).css("background-color", "transparent");
        }
    });
</script>
</body>
</html>