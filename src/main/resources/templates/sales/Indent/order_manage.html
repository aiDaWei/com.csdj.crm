<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="static/lib/layui/css/layui.css">
    <script src="static/js/jquery-2.1.1.js"></script>
    <script src="static/lib/layui/layui.js"></script>
</head>
<body>
<table id="demo" lay-filter="test"></table>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container layui-input-inline">
        <button class="layui-btn layui-btn-sm" lay-event="addOrder">添加</button>
        <button class="layui-btn layui-btn-sm" lay-event="updateOrder">编辑</button>
        <button class="layui-btn layui-btn-sm" lay-event="deleteOrder">删除</button>
        <button class="layui-btn layui-btn-sm" lay-event="lookOrder">查看</button>
        <button class="layui-btn layui-btn-sm" lay-event="startFlow">发起流程</button>
        <button class="layui-btn layui-btn-sm" lay-event="flowApprove">流程审批</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">流程痕迹</button>
        <button class="layui-btn layui-btn-sm" lay-event="flowImg">流程图</button>
        <button class="layui-btn layui-btn-sm" lay-event="againstApprove">反审批</button>
    </div>

    <div class="layui-input-inline">
        <select name="orderApprovalStatus" lay-filter="orderApprovalStatus">
            <option value="0">所有人的订单(全部)</option>
            <option value="1">所有人的订单(审批中)</option>
            <option value="2">所有人的订单(以成功)</option>
            <option value="3">所有人的订单(以失败)</option>
        </select>
    </div>
</script>

<form class="layui-form" action="">
    <div class="layui-fluid">
        <div id="two">
            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li class="layui-this">订单明细</li>
                    <li>收款计划</li>
                    <li>回款记录</li>
                    <li>发货单</li>
                    <li>费用报销单</li>
                    <li>退货单</li>
                    <li>附件</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <button  type="button" class="layui-btn  layui-btn-sm">曾加产品明细</button>
                        <button type="button" class="layui-btn  layui-btn-sm">增加附件明细</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>

                        <table class="layui-hide" id="test2" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button  type="button" class="layui-btn  layui-btn-sm">添加</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <div class="layui-inline" style="margin-left:10px;">
                        </div>
                        <table class="layui-hide" id="test3" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button  type="button" class="layui-btn  layui-btn-sm">添加</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <div class="layui-inline" style="margin-left:10px;">
                        </div>
                        <table class="layui-hide" id="test4" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button  type="button" class="layui-btn  layui-btn-sm">添加</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <table class="layui-hide" id="test5" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <table class="layui-hide" id="test6" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button  type="button" class="layui-btn  layui-btn-sm">添加</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <div class="layui-inline" style="margin-left:10px;">
                        </div>
                        <table class="layui-hide" id="test7" lay-filter="test"></table>
                    </div>
                    <div class="layui-tab-item">
                        <button  type="button" class="layui-btn  layui-btn-sm">添加</button>
                        <button type="button" class="layui-btn  layui-btn-sm">编辑</button>
                        <button type="button" class="layui-btn  layui-btn-sm">删除</button>
                        <button type="button" class="layui-btn  layui-btn-sm">查看</button>
                        <table class="layui-hide" id="test8" lay-filter="test"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
    layui.use(['form', 'layedit', 'laydate','table','element'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,table = layui.table
            ,layedit = layui.layedit
            ,laydate = layui.laydate
            ,element = layui.element;

        table.render({
            elem: '#test'
            ,height:300
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '合同编号'}
                ,{field:'username', title: '合同名称'}
                ,{field:'sex', title:'不含税总额'}
                ,{field:'city', title: '毛利润'}
                ,{field:'sign', title: '税额'}
                ,{field:'experience', title: '销售额'}
                ,{field:'score', title: '已回款金额'}
                ,{field:'classify', title: '已开票金额'}
                ,{field:'wealth', title: '审批状态'}
                ,{field:'city', title: '审批结果'}
                ,{field:'sign', title: '审批时间'}
                ,{field:'experience', title: '合同类型'}
                ,{field:'score', title: '关联客户'}
                ,{field:'classify', title: '关联对象'}
                ,{field:'wealth', title: '开始时间'}
                ,{field:'wealth', title: '结束时间'}
            ]
            ]
            ,page: true
        });
        table.render({
            elem: '#test2'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '产品名称'}
                ,{field:'username', title: '型号规格'}
                ,{field:'sex', title:'计量单位'}
                ,{field:'city', title: '数量'}
                ,{field:'sign', title: '基本单价'}
                ,{field:'experience', title: '销售价格'}
                ,{field:'score', title: '拆前总额'}
                ,{field:'classify', title: '拆后总额'}
                ,{field:'wealth', title: '实际折扣'}
                ,{field:'city', title: '毛利润'}
                ,{field:'sign', title: '税率'}
                ,{field:'experience', title: '税额'}
                ,{field:'score', title: '销售额'}
                ,{field:'classify', title: '明细附件'}
            ]
             ]
            ,page: true
        });
        table.render({
            elem: '#test3'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '标题'}
                ,{field:'username', title: '预计收款金额'}
                ,{field:'sex', title:'当前状态'}
                ,{field:'city', title: '合同/订单'}
                ,{field:'sign', title: '客户'}
                ,{field:'experience', title: '计划收款日期'}
                ,{field:'score', title: '实际收款日期'}
                ,{field:'classify', title: '负责人'}
                ,{field:'wealth', title: '创建时间'}

            ]
             ]
            ,page: true
        });
        table.render({
            elem: '#test4'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '收款金额'}
                ,{field:'username', title: '客户'}
                ,{field:'sex', title:'合同/订单'}
                ,{field:'city', title: '收款日期'}
                ,{field:'sign', title: '是否需要发票'}
                ,{field:'experience', title: '是否已开发票'}
                ,{field:'score', title: '经手人'}
                ,{field:'classify', title: '负责人'}

            ]
             ]
            ,page: true
        });
        table.render({
            elem: '#test5'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '发货单编号'}
                ,{field:'username', title: '主题'}
                ,{field:'sex', title:'发货人'}
                ,{field:'city', title: '发货时间'}
                ,{field:'sign', title: '收货客户'}
                ,{field:'experience', title: '合同/订单'}
                ,{field:'score', title: '发货方式'}
                ,{field:'classify', title: '发货状态'}
                ,{field:'score', title: '快递单编号'}
                ,{field:'classify', title: '收货联系人'}
            ]
             ]
            ,page: true
        });
        table.render({
            elem: '#test6'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '用途'}
                ,{field:'username', title: '分类'}
                ,{field:'sex', title:'费用归集'}
                ,{field:'city', title: '金额'}
                ,{field:'sign', title: '发生时间'}
                ,{field:'experience', title: '状态'}
                ,{field:'score', title: '关联客户'}
                ,{field:'classify', title: '关联业务对象'}
                ,{field:'score', title: '票据张数'}
                ,{field:'classify', title: '创建人'}
            ]
            ]
            ,page: true
        });
        table.render({
            elem: '#test7'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '退货名称'}
                ,{field:'username', title: '编号'}
                ,{field:'sex', title:'退货客户'}
                ,{field:'city', title: '退货订单或合同'}
                ,{field:'sign', title: '销售员'}
                ,{field:'experience', title: '分类'}
                ,{field:'score', title: '退款额'}
                ,{field:'classify', title: '收款人'}
                ,{field:'score', title: '当前状态'}
                ,{field:'classify', title: '审批时间'}
                ,{field:'classify', title: '审批结果'}
            ]
            ]
            ,page: true
        });
        table.render({
            elem: '#test8'
            ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            ,cols: [
                [
                {type:'checkbox'}
                ,{field:'id', title: '名称'}
                ,{field:'username', title: '文件'}
                ,{field:'sex', title:'所属对象'}
                ,{field:'city', title: '创建人'}
                ,{field:'sign', title: '创建时间'}

            ]
            ]
            ,page: true
        });
    });
</script>
<script>
    layui.use(['table','form'], function(){
        var table = layui.table,
            form = layui.form;

        //第一个实例
        table.render({
            elem: '#demo'
            ,height: 312
            ,url: 'find_order.htmls' //数据接口
            ,page: true //开启分页
            ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
            ,limits:[4,6,8]
            ,limit:4
            ,cols: [
                [ //表头
                 {type: 'checkbox', fixed: 'left'}
                ,{field: 'orderId', title: '订单编号',width:120}
                ,{field: 'orderName', title: '名称',width:120}
                ,{field: 'fkCusName', title: '所属客户',width:190,templet:function(data){
                    if(data.fkCusTypeId==0){
                        return "<a href='#'>[企业客户]"+data.fkCusName+"</a>"
                    }
                    if(data.fkCusTypeId==1){
                        return "<a href='#'>[个人客户]"+data.fkCusName+"</a>"
                    }
                    }
                    }
                ,{field: 'fkObjectName', title: '所属对象',width:190,templet:function (data) {
                        if(data.fkObjectTypeId==0){
                            return "<a href='#'>[销售机会]"+data.fkObjectName+"</a>"
                        }
                        if(data.fkObjectTypeId==1){
                            return "<a href='#'>[故障报修]"+data.fkObjectName+"</a>"
                        }

                    }}
                ,{field: 'orderType', title: '分类',width:120,templet: function (data) {
                        if (data.orderType == 0) {
                            return "产品销售";
                        }
                        if (data.orderType == 1) {
                            return "服务";
                        }
                        if (data.orderType == 2) {
                            return "代销";
                        }
                        if (data.orderType == 3) {
                            return "分销";
                        }
                        if (data.orderType == 4) {
                            return "业务合作";
                        }
                        if (data.orderType == 5) {
                            return "其它";
                        }
                    }
                }
                ,{field: 'orderTotalSum', title: '不含税总额',width:120,templet:function(data){
                    if (data.orderTotalSum==0){
                        return"无";
                    }else{
                        return data.orderTotalSum;
                    }
                    }}
                ,{field: 'orderGrossProfit', title: '毛利润',width:120,templet:function(data){
                        if (data.orderGrossProfit==0){
                            return"无";
                        }else{
                            return data.orderGrossProfit;
                        }
                    }}
                ,{field: 'orderRevenue', title: '税额',width:120,templet:function(data){
                        if (data.orderRevenue==0){
                            return"无";
                        }else{
                            return data.orderRevenue;
                        }
                    }}
                ,{field: 'orderSaleroom', title: '销售额',width:120,templet:function(data){
                        if (data.orderSaleroom==0){
                            return"无";
                        }else{
                            return data.orderSaleroom;
                        }
                    }}
                ,{field: 'orderAmountRemitted', title: '已收款金额',width:120,templet:function(data){
                        if (data.orderAmountRemitted==0){
                            return"无";
                        }else{
                            return data.orderAmountRemitted;
                        }
                    }}
                ,{field: 'orderInvoiceAmount', title: '已开票金额',width:120,templet:function(data){
                        if (data.orderInvoiceAmount==0){
                            return"无";
                        }else{
                            return data.orderInvoiceAmount;
                        }
                    }}
                ,{field: 'orderApprovalStatus', title: '审批状态',width:120,templet: function (data) {
                        if (data.orderApprovalStatus == 0) {
                            return "审批中";
                        }
                        if (data.orderApprovalStatus == 1) {
                            return "未启动";
                        }
                        if (data.orderApprovalStatus == 2) {
                            return "以完成";
                        }
                        return "";
                    }}
                ,{field: 'orderApprovalTime', title: '审批时间',width:120}
                ,{field: 'orderApprovalResult', title: '审批结果',width:120,templet: function (data) {
                        if (data.orderApprovalResult == 0) {
                            return "成功结束";
                        }
                        if (data.orderApprovalResult == 1) {
                            return "失败结束";
                        }
                        return "无";
                    }}
            ]
            ]
        });

        //头工具栏事件
        table.on('toolbar(test)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                , data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'addOrder':
                    layer.open({
                        type: 2,
                        area: ['1000px', '450px'],
                        title:'添加订单信息',
                        content: 'add_order.html',
                        btn: ['保存', '取消'],
                        btnAlign: 'c',
                        yes: function (index, layero) {
                            var body = layer.getChildFrame('body', index);
                            body.find('#btnAddOrdre').click();
                        },
                        btn2: function(index, layero){
                            layer.close(index);
                        }
                    });
                    break;
                case 'updateOrder':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能同时编辑一个');
                    } else {
                        var orderId=data[0].orderId;
                        layer.open({
                            title: '修改订单',
                            type: 2,
                            area: ['1000px', '450px'],
                            content: 'update_order.html?orderId=' + orderId + ''
                            , btn: ['保存','取消']
                            , btnAlign: 'c'
                            , yes: function (index, layero) {
                                var body = layer.getChildFrame('body', index);
                                body.find('#btnUpdateOrdre').click();
                            }
                            ,btn2: function(index, layero){
                                layer.close(index);
                            }
                        });
                    }
                    break;
                case 'deleteOrder':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else {
                        layer.confirm('确定要删除选中的行?', {icon: 3, title: '提示'}, function (index) {
                            var data = checkStatus.data;
                            var array = new Array();
                            for (var i = 0; i < data.length; i++) {
                                array[i] = data[i].orderId;
                            }
                            $.ajax({
                                url: "delete_order.htmls",
                                type: "get",
                                data: {array: array},
                                traditional: true,
                                success: function (data) {
                                    if (data.show == "success") {
                                        layer.msg('删除成功', {icon: 1, time: 2000}, function () {
                                            window.location.reload();
                                        });
                                    }
                                },
                                error:function () {
                                    layer.msg('ajax执行错误',{icon:2,time:2000});
                                }
                            })
                        });
                    }
                    break;
                case 'lookOrder':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能同时查看一条');
                    } else {
                        var orderId=data[0].orderId;
                        layer.open({
                            title: '查看订单',
                            type: 2,
                            area: ['600px', '400px'],
                            content: 'look_order.html?orderId=' + orderId + ''
                            , btn: ['确定','取消']
                            , btnAlign: 'c'
                            , yes: function (index, layero) {
                                layer.close(index);
                            }
                            ,btn2: function(index, layero){
                                layer.close(index);
                            }
                        });
                    }
                    break;
                case 'flowImg':
                    layer.open({
                        type: 1,
                        title:'流程图',
                        area: ['1000px', '450px'],
                        content: $('#layer-photos-demo'),
                        btn: ['确定','取消'],
                        btnAlign: 'c',
                        yes: function (index, layero) {
                            layer.close(index);
                        },
                        btn2: function(index, layero){
                            layer.close(index);
                        }
                    });
                    break;
                case 'startFlow':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能选择一行');
                    } else {
                        var orderApprovalStatus=data[0].orderApprovalStatus;
                        var orderId=data[0].orderId;
                        if (orderApprovalStatus!=1){
                            layer.msg('流程以存在不能再次创建',{icon:2})
                        }else{
                            $.ajax({
                                url: "update_order_approval_status_htmls",
                                type: "get",
                                data: {"orderId":orderId},
                                traditional: true,
                                success: function (data) {
                                    if (data>0){
                                        layer.msg('流程创建成功', {icon: 1, time: 2000}, function () {
                                            window.location.reload();
                                        });
                                    }
                                },
                                error:function () {
                                    layer.msg('ajax执行错误',{icon:2,time:2000});
                                }
                            })
                        }
                    }
                    break;
                case 'flowApprove':
                    layer.open({
                        type: 2,
                        title:'流程审批',
                        area: ['900px', '400px'],
                        content: 'flow_approve.html',
                        btn: ['确定','取消'],
                        btnAlign: 'c',
                        yes: function (index, layero) {
                            layer.close(index);
                            window.location.reload();
                        },
                        btn2: function(index, layero){
                            layer.close(index);
                            window.location.reload();
                        }
                    });
                    break;
                case 'againstApprove':
                    if (data.length === 0) {
                        layer.msg('请选择一行');
                    } else if (data.length > 1) {
                        layer.msg('只能选择一行');
                    }else {
                        var orderId=data[0].orderId;
                        layer.confirm('你确定要反审批该条记录吗?', {icon: 3, title: '提示'}, function (index) {
                            $.ajax({
                                url: "update_against_approve_htmls",
                                type: "get",
                                data: {"orderId": orderId},
                                traditional: true,
                                success: function (data) {
                                    if (data > 0) {
                                        layer.msg('反审核成功', {icon: 1, time: 2000}, function () {
                                            window.location.reload();
                                        });
                                    }
                                },
                                error: function () {
                                    layer.msg('ajax执行错误', {icon: 2, time: 2000});
                                }
                            })
                        });
                    }
                    break;

                //自定义头工具栏右侧图标 - 提示
                case 'LAYTABLE_TIPS':
                    layer.alert('这是工具栏右侧自定义的一个图标按钮');
                    break;
            };
        });

        //审批状态监听
        form.on('select(orderApprovalStatus)', function(data){
            var orderApprovalStatus=data.value;
            table.reload('demo', {
                url: 'find_order.htmls'
                , where: {
                    orderApprovalStatus: orderApprovalStatus,
                } //设定异步数据接口的额外参数
                , page: {
                    curr: 1 //重新从第 1 页开始
                }
                //,height: 300
            });
        });

    });
</script>

<div id="layer-photos-demo" class="layer-photos-demo" hidden>
    <img layer-src="static/images/flowImg.png" src="static/images/flowImg.png" alt="流程图" width="900px" height="400px">
</div>
</body>
</html>